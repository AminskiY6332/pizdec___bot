# ü§ñ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Axidi Photo AI Bot

–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∑–∞–ø—É—Å–∫—É, –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –±–æ—Ç–æ–º –≤ production —Å—Ä–µ–¥–µ.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫

### 1Ô∏è‚É£ –û–±—ã—á–Ω—ã–π –∑–∞–ø—É—Å–∫ (—Ä—É—á–Ω–æ–π)
```bash
# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
./start_axidi_bot.sh

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
./status_axidi_bot.sh

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞
./stop_axidi_bot.sh

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
./restart_axidi_bot.sh
```

### 2Ô∏è‚É£ –°–∏—Å—Ç–µ–º–Ω—ã–π —Å–µ—Ä–≤–∏—Å (–∞–≤—Ç–æ–∑–∞–ø—É—Å–∫)
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–∞–∫ —Å–∏—Å—Ç–µ–º–Ω—ã–π —Å–µ—Ä–≤–∏—Å
./install_service.sh

# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ systemctl
systemctl start axidi-bot      # –ó–∞–ø—É—Å–∫
systemctl stop axidi-bot       # –û—Å—Ç–∞–Ω–æ–≤–∫–∞
systemctl restart axidi-bot    # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
systemctl status axidi-bot     # –°—Ç–∞—Ç—É—Å
```

## üìã –û–ø–∏—Å–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤

### üöÄ `start_axidi_bot.sh`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–æ–ª–Ω—ã–π –∑–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã –±–æ—Ç–∞

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç**:
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (Python3, Gunicorn)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Ç–æ–∫–µ–Ω—ã)
- ‚úÖ –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å—Ç–∞—Ä—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –ª–æ–≥–æ–≤
- ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ—Ç Gunicorn (Flask endpoints)
- ‚úÖ –¢–µ—Å—Ç–∏—Ä—É–µ—Ç endpoints (/health, /webhook)
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
```bash
./start_axidi_bot.sh
```

### üõë `stop_axidi_bot.sh`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–æ–ª–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã –±–æ—Ç–∞

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç**:
- üõë Graceful –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ Gunicorn –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- üõë –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å—à–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- üõë –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–æ—Ä—Ç–∞ 5000
- üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –≤—Å–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
```bash
./stop_axidi_bot.sh
```

### üìä `status_axidi_bot.sh`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã

**–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç**:
- üîß –°—Ç–∞—Ç—É—Å –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ (Gunicorn workers)
- üåê –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤
- üîó –ü—Ä–æ–≤–µ—Ä–∫–∞ endpoints (health, webhook)
- üíª –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã (CPU, RAM, –¥–∏—Å–∫)
- üìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏
- üìä –û–±—â–∏–π —Å—Ç–∞—Ç—É—Å (–û–ù–õ–ê–ô–ù/–û–§–õ–ê–ô–ù)

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
```bash
./status_axidi_bot.sh
```

### üîÑ `restart_axidi_bot.sh`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç**:
- üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ (stop_axidi_bot.sh)
- ‚è±Ô∏è –ü–∞—É–∑–∞ 3 —Å–µ–∫—É–Ω–¥—ã
- üöÄ –ó–∞–ø—É—Å–∫ (start_axidi_bot.sh)
- üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
```bash
./restart_axidi_bot.sh
```

### ‚öôÔ∏è `install_service.sh`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–∞–∫ —Å–∏—Å—Ç–µ–º–Ω—ã–π —Å–µ—Ä–≤–∏—Å

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç**:
- üìÅ –ö–æ–ø–∏—Ä—É–µ—Ç axidi-bot.service –≤ /etc/systemd/system/
- üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç systemd
- üîß –í–∫–ª—é—á–∞–µ—Ç –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫
- üöÄ –ó–∞–ø—É—Å–∫–∞–µ—Ç —Å–µ—Ä–≤–∏—Å
- üìä –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
```bash
./install_service.sh
```

## üìä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### Production Mode:
```
üåê Internet
    ‚Üì
üî• Gunicorn (Production WSGI Server)
    ‚îú‚îÄ‚îÄ üì± Telegram Bot (polling)
    ‚îú‚îÄ‚îÄ üí≥ YooKassa Webhook (/webhook)
    ‚îú‚îÄ‚îÄ üìä Health Check (/health)
    ‚îî‚îÄ‚îÄ üß™ Test Webhook (/test_webhook)
    ‚Üì
üìä Port 5000 (–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π)
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- **Gunicorn**: Multiple workers –¥–ª—è Flask endpoints
- **Telegram Bot**: Polling –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
- **YooKassa**: Webhook –¥–ª—è –ø–ª–∞—Ç–µ–∂–µ–π
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: `/var/log/axidi/` –∏ `/var/log/gunicorn/`

## üåê Endpoints

| Endpoint | –ú–µ—Ç–æ–¥ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|----------|-------|------------|
| `/health` | GET | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ |
| `/webhook` | POST | YooKassa –ø–ª–∞—Ç–µ–∂–∏ |
| `/test_webhook` | POST | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ webhook |

## üìã –õ–æ–≥–∏

### –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –ª–æ–≥–æ–≤:
```
/var/log/axidi/
‚îú‚îÄ‚îÄ access.log          # HTTP –∑–∞–ø—Ä–æ—Å—ã
‚îú‚îÄ‚îÄ error.log           # –û—à–∏–±–∫–∏ Gunicorn
‚îî‚îÄ‚îÄ startup.log         # –õ–æ–≥–∏ –∑–∞–ø—É—Å–∫–∞

/var/log/gunicorn/
‚îî‚îÄ‚îÄ startup.log         # –°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏ –∑–∞–ø—É—Å–∫–∞
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:
```bash
# –í—Å–µ –ª–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
tail -f /var/log/axidi/access.log

# –û—à–∏–±–∫–∏
tail -f /var/log/axidi/error.log

# –°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–∞
journalctl -u axidi-bot -f

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å—Ç—Ä–æ–∫
journalctl -u axidi-bot -n 50
```

## üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–º

### –ß–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç—ã (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
```bash
./start_axidi_bot.sh    # –ó–∞–ø—É—Å–∫
./stop_axidi_bot.sh     # –û—Å—Ç–∞–Ω–æ–≤–∫–∞
./status_axidi_bot.sh   # –°—Ç–∞—Ç—É—Å
./restart_axidi_bot.sh  # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
```

### –ß–µ—Ä–µ–∑ systemctl (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Å–µ—Ä–≤–∏—Å):
```bash
systemctl start axidi-bot      # –ó–∞–ø—É—Å–∫
systemctl stop axidi-bot       # –û—Å—Ç–∞–Ω–æ–≤–∫–∞
systemctl restart axidi-bot    # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
systemctl status axidi-bot     # –°—Ç–∞—Ç—É—Å
systemctl enable axidi-bot     # –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –í–ö–õ
systemctl disable axidi-bot    # –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –í–´–ö–õ
```

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ—Ä—Ç –∑–∞–Ω—è—Ç
```bash
# –û—Å–≤–æ–±–æ–¥–∏—Ç—å –ø–æ—Ä—Ç 5000
fuser -k 5000/tcp

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∑–∞–Ω–∏–º–∞–µ—Ç –ø–æ—Ä—Ç
netstat -tulpn | grep :5000
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ü—Ä–æ—Ü–µ—Å—Å—ã –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è
```bash
# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞
pkill -KILL -f "gunicorn.*main:app"
pkill -KILL -f "python.*main\.py"
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç endpoints
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
curl -v http://localhost:5000/health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
tail -20 /var/log/axidi/error.log
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
echo $TELEGRAM_BOT_TOKEN
echo $YOOKASSA_SHOP_ID
echo $SECRET_KEY

# –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ .env
source .env
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç:
```bash
# –î–æ–±–∞–≤–∏—Ç—å –≤ crontab
echo "*/5 * * * * /root/axidi_pr_v1/status_axidi_bot.sh > /dev/null 2>&1" | crontab -
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:
```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
htop

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ Gunicorn
ps aux | grep gunicorn

# –ê–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
netstat -an | grep :5000 | grep ESTABLISHED | wc -l
```

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∫–∞
./stop_axidi_bot.sh

# 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
git pull origin main

# 3. –ó–∞–ø—É—Å–∫
./start_axidi_bot.sh

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞
./status_axidi_bot.sh
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å–æ–±–µ—Ä–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:

```bash
# –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
./status_axidi_bot.sh > system_report.txt

# –õ–æ–≥–∏
tail -100 /var/log/axidi/error.log > error_logs.txt

# –ü—Ä–æ—Ü–µ—Å—Å—ã
ps aux | grep -E "(gunicorn|python)" > processes.txt

# –°–µ—Ç–µ–≤–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
netstat -tulpn | grep :5000 > network.txt
```

---

## üéØ –†–µ–∑—é–º–µ

‚úÖ **–ü—Ä–æ—Å—Ç–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: –û–¥–∏–Ω —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞/–æ—Å—Ç–∞–Ω–æ–≤–∫–∏
‚úÖ **–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫**: Systemd —Å–µ—Ä–≤–∏—Å —Å auto-restart
‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏
‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –í—Å–µ —Å–æ–±—ã—Ç–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
‚úÖ **Production-ready**: Gunicorn + multiple workers
‚úÖ **YooKassa**: –ì–æ—Ç–æ–≤ –∫ –ø—Ä–∏–µ–º—É –ø–ª–∞—Ç–µ–∂–µ–π

**–í–∞—à –±–æ—Ç –≥–æ—Ç–æ–≤ –∫ production –Ω–∞–≥—Ä—É–∑–∫–∞–º! üöÄ**
